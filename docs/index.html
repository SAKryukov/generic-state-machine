<!DOCTYPE html>
<html>
<head>
    <title>Generic State Machines</title>
    <meta charset="utf-8"/>
    <style type="text/css">
        @import url(https://SAKryukov.github.io/publications/code/documentation.css);
        /*
        code { color: green; }
        p.title { margin-top: 0; }
        p.author { text-align: right; }
        pre { margin-top: 0; margin-bottom: 0; }
        p, h1, h2, h3, h4 { margin-top: 1em; margin-bottom: 0.4em; }
        p.toc br { content: ""; display: block; margin-top: 0.2em; }
        */
        img { width: 70%; display: block; margin-left: auto; margin-right: auto; }
        p.extensible-markdown { border-top: solid thin darkgray; font-size: 80%; }
        table, td { border: solid thin black; border-collapse: collapse; font-size: 120%; }
        table { margin-left: 2em; }
        td { width: 1.4em; text-align: center; vertical-align: middle; }
    </style>
</head>
<body>

<p class="title">Generic State Machines</p><p>The generic classes <a href="#heading-class-transitionsystem">TransitionSystem</a>,
<a href="#heading-class-acceptor">Acceptor</a>,
and <a href="#heading-class-transducer">Transducer</a> provide the functionality of
<a href="https://en.wikipedia.org/wiki/Transition_system">transition systems</a> and
<a href="https://en.wikipedia.org/wiki/Finite-state_machine">finite-state machines</a>.
They rely on enumeration-type generic parameters representing the sets of states and the input and output alphabets.</p><p class="toc">
<a style="margin-left: 0em;" href="#heading-statemachines-namespace">StateMachines Namespace</a><br/>
<a style="margin-left: 3em;" href="#heading-notes-on-the-generic-parameters">Notes on the Generic Parameters</a><br/>
<a style="margin-left: 3em;" href="#heading-delegate-validstatetransitionaction">Delegate ValidStateTransitionAction</a><br/>
<a style="margin-left: 3em;" href="#heading-delegate-invalidstatetransitionaction">Delegate InvalidStateTransitionAction</a><br/>
<a style="margin-left: 3em;" href="#heading-notastate-and-notanalphabetelement-attributes">NotAState and NotAnAlphabetElement Attributes</a><br/>
<a style="margin-left: 3em;" href="#heading-class-transitionsystem">Class TransitionSystem</a><br/>
<a style="margin-left: 6em;" href="#heading-public-constructor">Public Constructor</a><br/>
<a style="margin-left: 6em;" href="#heading-public-methods">Public Methods</a><br/>
<a style="margin-left: 9em;" href="#heading-resetstate">ResetState</a><br/>
<a style="margin-left: 9em;" href="#heading-addvalidstatetransition">AddValidStateTransition</a><br/>
<a style="margin-left: 9em;" href="#heading-addvalidstatetransitionchain">AddValidStateTransitionChain</a><br/>
<a style="margin-left: 9em;" href="#heading-addinvalidstatetransition">AddInvalidStateTransition</a><br/>
<a style="margin-left: 9em;" href="#heading-istransitionvalid">IsTransitionValid</a><br/>
<a style="margin-left: 9em;" href="#heading-trytransitionto">TryTransitionTo</a><br/>
<a style="margin-left: 9em;" href="#heading-labyrinth">Labyrinth</a><br/>
<a style="margin-left: 9em;" href="#heading-finddeadends">FindDeadEnds</a><br/>
<a style="margin-left: 6em;" href="#heading-public-properties">Public Properties</a><br/>
<a style="margin-left: 9em;" href="#heading-currentstate">CurrentState</a><br/>
<a style="margin-left: 9em;" href="#heading-longestpaths">LongestPaths</a><br/>
<a style="margin-left: 9em;" href="#heading-maximumpaths">MaximumPaths</a><br/>
<a style="margin-left: 6em;" href="#heading-notes">Notes</a><br/>
<a style="margin-left: 3em;" href="#heading-delegate-acceptortransitionaction">Delegate AcceptorTransitionAction</a><br/>
<a style="margin-left: 3em;" href="#heading-delegate-invalidacceptorinputhandler">Delegate InvalidAcceptorInputHandler</a><br/>
<a style="margin-left: 3em;" href="#heading-class-acceptor">Class Acceptor</a><br/>
<a style="margin-left: 6em;" href="#heading-inherited-public-members">Inherited Public Members</a><br/>
<a style="margin-left: 6em;" href="#heading-public-constructor.">Public Constructor</a><br/>
<a style="margin-left: 6em;" href="#heading-public-methods.">Public Methods</a><br/>
<a style="margin-left: 9em;" href="#heading-addstatetransitionfunctionpart">AddStateTransitionFunctionPart</a><br/>
<a style="margin-left: 9em;" href="#heading-addinvalidinput">AddInvalidInput</a><br/>
<a style="margin-left: 9em;" href="#heading-transitionsignal">TransitionSignal</a><br/>
<a style="margin-left: 3em;" href="#heading-delegate-mooremachineoutputaction">Delegate MooreMachineOutputAction</a><br/>
<a style="margin-left: 3em;" href="#heading-delegate-mealymachineoutputaction">Delegate MealyMachineOutputAction</a><br/>
<a style="margin-left: 3em;" href="#heading-class-transducer">Class Transducer</a><br/>
<a style="margin-left: 6em;" href="#heading-inherited-public-members.">Inherited Public Members</a><br/>
<a style="margin-left: 6em;" href="#heading-public-constructor..">Public Constructor</a><br/>
<a style="margin-left: 6em;" href="#heading-public-methods..">Public Methods</a><br/>
<a style="margin-left: 9em;" href="#heading-addoutputfunctionpart">AddOutputFunctionPart</a><br/>
<a style="margin-left: 9em;" href="#heading-signal">Signal</a><br/>
<a style="margin-left: 0em;" href="#heading-examples">Examples</a><br/>
<a style="margin-left: 3em;" href="#heading-room-door-example">Room Door Example</a><br/>
<a style="margin-left: 3em;" href="#heading-non-enumeration-example">Non-Enumeration Example</a><br/>
<a style="margin-left: 3em;" href="#heading-grid-example">Grid Example</a><br/>
<a style="margin-left: 3em;" href="#heading-zoo-example">Zoo Example</a><br/>
<a style="margin-left: 3em;" href="#heading-car-transducer-example">Car Transducer Example</a><br/>
<a style="margin-left: 0em;" href="#heading-compatibility-and-build">Compatibility and Build</a><br/>
</p><h1 id="heading-statemachines-namespace">StateMachines Namespace</h1>
<p>Inheritance diagram:</p><pre><span style = "border: thin solid black; padding-left: 1em; padding-right: 1em">System.Object</span><big>&#x21FD;</big><span style = "border: thin solid black; padding-left: 1em; padding-right: 1em">TransitionSystem</span><big>&#x21FD;</big><span style = "border: thin solid black; padding-left: 1em; padding-right: 1em">Acceptor</span><big>&#x21FD;</big><span style = "border: thin solid black; padding-left: 1em; padding-right: 1em">Transducer</span>
</pre><h2 id="heading-notes-on-the-generic-parameters">Notes on the Generic Parameters</h2>
<p>The types of the namespace <code>StateMachines</code> depend on the generic-type parameters <code>STATE</code>, <code>INPUT</code>, and <code>OUTPUT</code>.</p><p>Typically, a generic-type parameter could be of any enumeration type with its enumeration members representing states.
However, it is not a strict rule. In principle, any type with public static fields can be used for the <code>STATE</code> type.
In this case, the public static fields will represent the transition system states.
Please see <a href="#heading-non-enumeration-example">the example</a> illustrating the use of a non-enumeration type <code>STATE</code>.</p><h2 id="heading-delegate-validstatetransitionaction">Delegate ValidStateTransitionAction</h2>
<p>An instance of the delegate provides a way to define a side effect of a valid transition between two states, <code>startState</code>, and <code>finishState</code>. For example, in the hardware automation applications, it can operate the hardware.</p><pre lang="C#" id="api-valid-state-transition-action"><span class="keyword highlighter">public</span> delegate <span class="keyword highlighter">void</span> <span class="_custom-word_ highlighter">ValidStateTransitionAction</span>&lt;<span class="_custom-word_ highlighter">STATE</span>&gt;(<span class="_custom-word_ highlighter">STATE</span> startState, <span class="_custom-word_ highlighter">STATE</span> finishState);
</pre><p>The delegate instance is used in the <a href="#heading-addvalidstatetransition">TransitionSystem.AddValidStateTransition</a> and <a href="#heading-addinvalidstatetransition">TransitionSystem.AddValidStateTransitionChain</a> call.</p><h2 id="heading-delegate-invalidstatetransitionaction">Delegate InvalidStateTransitionAction</h2>
<p>An instance of the delegate provides the optional information on an invalid transition between two states, <code>startState</code> and <code>finishState</code>. Its return <code>string</code> value can be used to explain why an attempted transition between the states is considered invalid.</p><pre lang="C#" id="api-invalid-state-transition-action"><span class="keyword highlighter">public</span> delegate string <span class="_custom-word_ highlighter">InvalidStateTransitionAction</span>&lt;<span class="_custom-word_ highlighter">STATE</span>&gt;(<span class="_custom-word_ highlighter">STATE</span> startState, <span class="_custom-word_ highlighter">STATE</span> finishState);
</pre><p>The delegate instance is used in the <a href="#heading-addinvalidstatetransition">TransitionSystem.AddInvalidStateTransition</a> call.</p><h2 id="heading-notastate-and-notanalphabetelement-attributes">NotAState and NotAnAlphabetElement Attributes</h2>
<p>These attributes can be used to mark some enumeration-type members. It excludes them from the set of states or the input or output alphabets. It can be useful to create members irrelevant to the transition system behavior but used for some calculations. For example, such a member can be a bitwise <code>OR</code> combination of several states.</p><pre lang="C#" id="api-not-a-state">[System.AttributeUsage(System.AttributeTargets.Field, AllowMultiple = <span class="keyword highlighter">false</span>, Inherited = <span class="keyword highlighter">false</span>)]
<span class="keyword highlighter">public</span> <span class="keyword highlighter">class</span> <span class="_custom-word_ highlighter">NotAStateAttribute</span> : ExcludeAttribute {}
[System.AttributeUsage(System.AttributeTargets.Field, AllowMultiple = <span class="keyword highlighter">false</span>, Inherited = <span class="keyword highlighter">false</span>)]
<span class="keyword highlighter">public</span> <span class="keyword highlighter">class</span> <span class="_custom-word_ highlighter">NotAnAlphabetElementAttribute</span> : ExcludeAttribute {}
</pre><p>Formally, these attributes can be used interchangeably and applied to any enumeration-member public field. They are made different only for the clarity of the terms “state” and “alphabets”. The effect of these attributes is the same: the members marked with one of these attributes are skipped when building a set of states of an alphabet.</p><p>Example:</p><pre lang="C#"><span class="keyword highlighter">enum</span> <span class="_custom-word_ highlighter">NotAStateAttribute</span> {
    Locked = 1, Closed = 2, Opened = 4,
    OpenedInside = 8, ClosedInside = 16, LockedInside = 32,
    [<span class="_custom-word_ highlighter">NotAState</span>] Inside = OpenedInside | ClosedInside | LockedInside };
</pre><p>An attempt to perform a state transition to a <code>NotAState</code> enumeration value using <a href="#heading-trytransitionto"><code>TryTransitionTo</code></a> will throw an exception.</p><h2 id="heading-class-transitionsystem">Class TransitionSystem</h2>
<p>The class <a href="#heading-class-transitionsystem"><code>TransitionSystem</code></a> provides a way to create
a <a href="https://en.wikipedia.org/wiki/Transition_system">transition system</a> based on any enumeration type
representing a set of states. For the class instance, a state transition graph can be created.
The instance can walk between states using permitted transitions,
and the optional delegate representing the side effect of a transition can be called.
An attempt to perform an invalid transition can provide optional information,
explaining why the transition is invalid.
The class also implements several graph algorithms,
including <a href="https://en.wikipedia.org/wiki/NP-hardness">NP-hard</a> ones,
such as <a href="#heading-longestpaths">finding the longest possible paths</a>.</p><pre lang="C#" id="api-transition-system"><span class="keyword highlighter">public</span> <span class="keyword highlighter">class</span> <span class="_custom-word_ highlighter">TransitionSystem</span>&lt;<span class="_custom-word_ highlighter">STATE</span>&gt; : <span class="_custom-word_ highlighter">TransitionSystemBase</span>&lt;<span class="_custom-word_ highlighter">STATE</span>&gt;{/* &hellip; */}
</pre><h3 id="heading-public-constructor">Public Constructor</h3>
<p>Creates an instance of <code>TransitionSystem</code>.</p><p>Parameter: <code>STATE initialState = default</code>. Defines the initial state of the transition system. See also <a href="#heading-resetstate"><code>ResetState</code></a>.</p><p>Note that the use of a non-default initial state can be critically important when a default value
for the <code>STATE</code> type is not a state. It can happen if this default value is excluded using the
[<a href="#heading-notastate-and-notanalphabetelement-attributes"><code>NotAState</code></a>] attribute. Another case of a non-state value is demonstrated by the <a href="#heading-non-enumeration-example">non-enumeration example</a>.</p><pre lang="C#" id="api-constructor"><span class="keyword highlighter">public</span> <span class="_custom-word_ highlighter">TransitionSystem</span>(<span class="_custom-word_ highlighter">STATE</span> initialState = <span class="keyword highlighter">default</span>);
</pre><h3 id="heading-public-methods">Public Methods</h3>
<h4 id="heading-resetstate">ResetState</h4>
<p>Unconditionally jumps to the <em>initial state</em> defined by the <a href="#heading-public-constructor">constructor</a>. No <a href="#heading-delegate-validstatetransitionaction">delegate instances</a> are called even if there is a valid transition between the <a href="#heading-currentstate">current state</a> and the initial state.</p><pre lang="C#" id="api-reset-state"><span class="keyword highlighter">public</span> <span class="_custom-word_ highlighter">STATE</span> ResetState();
</pre><h4 id="heading-addvalidstatetransition">AddValidStateTransition</h4>
<p>Adds an edge to the transition system’s <em>transition graph</em> between the states <code>startState</code> and <code>finishState</code>. If the parameter <code>undirected</code> is <code>true</code>, it makes both transitions valid, from <code>startState</code> to <code>finishState</code>, and from <code>finishState</code> to <code>startState</code>.</p><p>Optionally, a delegate instance of the type <a href="#heading-delegate-validstatetransitionaction"><code>StateTransitionAction</code></a> is specified. In this case (when the delegate instance is not <code>null</code>), the delegate’s method will be called on each call to <a href="#heading-trytransitionto"><code>TryTransitionTo</code></a> between corresponding states.</p><p>Note that the transition function rules are not respected by the methods <a href="#heading-transitionsignal%22"><code>Accessor.TransitionSignal</code></a> and <a href="#heading-signal"><code>Transducer.Signal</code></a>.</p><pre lang="C#" id="api-add-valid-state-transition"><span class="keyword highlighter">public</span> <span class="keyword highlighter">void</span> AddValidStateTransition(<span class="_custom-word_ highlighter">STATE</span> startState, <span class="_custom-word_ highlighter">STATE</span> finishState, <span class="_custom-word_ highlighter">StateTransitionAction</span>&lt;<span class="_custom-word_ highlighter">STATE</span>&gt; action, bool undirected = <span class="keyword highlighter">false</span>);
</pre><h4 id="heading-addvalidstatetransitionchain">AddValidStateTransitionChain</h4>
<p>Adds a transition chain to the transition system’s <em>transition graph</em>. Note that if the parameter <code>undirected</code> is <code>true</code>, it makes all the graph edges between the adjacent pairs of states <em>undirected</em>, that is, the transitions in both directions become valid.</p><p>Optionally, a delegate instance of the type <a href="#heading-delegate-validstatetransitionaction"><code>StateTransitionAction</code></a> is specified. In this case (when the delegate instance is not <code>null</code>), the same delegate’s method will be called on each call to <a href="#heading-trytransitionto"><code>TryTransitionTo</code></a> between corresponding states in the chain.</p><pre lang="C#" id="api-add-valid-state-transition-chain"><span class="keyword highlighter">public</span> int AddValidStateTransitionChain(<span class="_custom-word_ highlighter">StateTransitionAction</span>&lt;<span class="_custom-word_ highlighter">STATE</span>&gt; action, bool undirected = <span class="keyword highlighter">false</span>, params <span class="_custom-word_ highlighter">STATE</span>[] chain)
</pre><h4 id="heading-addinvalidstatetransition">AddInvalidStateTransition</h4>
<p>Defines the information in an invalid state transition between the states <code>startState</code> and <code>finishState</code>. This information is used in the return of the call to <a href="#heading-istransitionvalid">IsTransitionValid</a> and <a href="#heading-trytransitionto">TryTransitionTo</a>. See also <a href="#heading-delegate-invalidstatetransitionaction">InvalidStateTransitionAction</a>.</p><p>Note that the transition function rules are not respected by the methods <a href="#heading-transitionsignal%22"><code>Accessor.TransitionSignal</code></a> and <a href="#heading-signal"><code>Transducer.Signal</code></a>.</p><pre lang="C#" id="api-add-invalid-state-transition"><span class="keyword highlighter">public</span> <span class="keyword highlighter">void</span> AddInvalidStateTransition(<span class="_custom-word_ highlighter">STATE</span> startState, <span class="_custom-word_ highlighter">STATE</span> finishState, <span class="_custom-word_ highlighter">InvalidStateTransitionAction</span>&lt;<span class="_custom-word_ highlighter">STATE</span>&gt; action)
</pre><h4 id="heading-istransitionvalid">IsTransitionValid</h4>
<p>Checks if a transition between the state <code>startState</code> and <code>finishState</code> is valid. In addition to the status <code>isValid</code>, returns <code>validityComment</code> that can explain why the transition is invalid. This information is optional, defined using <a href="#heading-addinvalidstatetransition">AddInvalidStateTransition</a>.</p><pre lang="C#" id="api-is-transition-valid"><span class="keyword highlighter">public</span> (bool isValid, string validityComment) IsTransitionValid(<span class="_custom-word_ highlighter">STATE</span> startState, <span class="_custom-word_ highlighter">STATE</span> finishState);
</pre><h4 id="heading-trytransitionto">TryTransitionTo</h4>
<p>Tries to perform the transition from the <a href="#heading-currentstate">current state</a> to the state <code>state</code>. Returns the success status of the transition and the comment on the transition validity <code>validityComment</code>. If the transition is invalid, <code>validityComment</code> can provide some information on the reason. This information is optional, see <a href="#heading-addinvalidstatetransition">AddInvalidStateTransition</a>.</p><p>If the transition is successful, the <a href="#heading-currentstate">current state</a> becomes <code>state</code>.</p><p>An attempt to perform the transition to the same state is considered valid. In this case, no delegate methods are called.</p><pre lang="C#" id="api-try-transition-to"><span class="keyword highlighter">public</span> (bool success, string validityComment) TryTransitionTo(<span class="_custom-word_ highlighter">STATE</span> state);
</pre><h4 id="heading-labyrinth">Labyrinth</h4>
<p>Returns all the permitted paths between the states <code>start</code> and <code>finish</code>. If <code>shortest</code> is <code>true</code> the method still finds all paths, but then it determines the shortest path length and returns only the array of paths of the minimal length.</p><pre lang="C#" id="api-labyrinth"><span class="keyword highlighter">public</span> <span class="_custom-word_ highlighter">STATE</span>[][] Labyrinth(<span class="_custom-word_ highlighter">STATE</span> start, <span class="_custom-word_ highlighter">STATE</span> finish, bool shortest = <span class="keyword highlighter">false</span>);
</pre><h4 id="heading-finddeadends">FindDeadEnds</h4>
<p>Find all “dead ends”, the states not visited along any paths between the states <code>start</code> and <code>finish</code>. Returns <code>allPaths</code>, all permitted paths between <code>start</code> and <code>finish</code>, and <code>deadEnds</code>.</p><pre lang="C#" id="api-find-dead-ends-2"><span class="keyword highlighter">public</span> (<span class="_custom-word_ highlighter">STATE</span>[][] allPaths, <span class="_custom-word_ highlighter">STATE</span>[] deadEnds) FindDeadEnds(<span class="_custom-word_ highlighter">STATE</span> start, <span class="_custom-word_ highlighter">STATE</span> finish);
</pre><p>Another form of <code>FindDeadEnds</code> assumes that the parameter <code>allPaths</code> is the array of paths obtained through the prior call to <a href="#heading-labyrinth">Labyrinth</a> between the state <code>start</code> and some other state <code>finish</code>. In this case, the <code>allPaths</code> array will contain all paths ending with the state <code>finish</code> passed as the second parameter to <a href="#heading-labyrinth">Labyrinth</a>.</p><pre lang="C#" id="api-find-dead-ends"><span class="keyword highlighter">public</span> <span class="_custom-word_ highlighter">STATE</span>[] FindDeadEnds(<span class="_custom-word_ highlighter">STATE</span> start, <span class="_custom-word_ highlighter">STATE</span>[][] allPaths);
</pre><h3 id="heading-public-properties">Public Properties</h3>
<h4 id="heading-currentstate">CurrentState</h4>
<p>Returns the <em>current state</em> of the transition system. Before the very first transition of the instance, the current state is the one defined by the <a href="#heading-public-constructor">constructor</a>.</p><pre lang="C#" id="api-current-state"><span class="keyword highlighter">public</span> <span class="_custom-word_ highlighter">STATE</span> CurrentState;
</pre><h4 id="heading-longestpaths">LongestPaths</h4>
<pre lang="C#" id="api-longest-paths"><span class="keyword highlighter">public</span> (int numberOfPaths, int longestPathLength, <span class="_custom-word_ highlighter">STATE</span>[][] longestPaths) LongestPaths; <span class="comment text highlighter">//NP-hard</span>
</pre><h4 id="heading-maximumpaths">MaximumPaths</h4>
<pre lang="C#" id="api-maximum-paths"><span class="keyword highlighter">public</span> (int maximumNumberOfPaths, (<span class="_custom-word_ highlighter">STATE</span> start, <span class="_custom-word_ highlighter">STATE</span> finish)[] pairsAtMax) MaximumPaths; <span class="comment text highlighter">//NP-hard</span>
</pre><h3 id="heading-notes">Notes</h3>
<p>All paths returned by <a href="#heading-labyrinth"><code>Labyrinth</code></a>, <a href="#heading-finddeadends"><code>FindDeadEnds</code></a>, and <a href="#heading-longestpaths"><code>LongestPaths</code></a> are represented as arrays <code>STATE[]</code> or arrays of paths <code>STATE[][]</code>, each path represented as an array of <code>STATE</code>. In the array of states, the starting state of the path is not included, and the final state of the path is included.</p><p>In other words, given a permitted path between the <a href="#heading-currentstate">current state</a> of a transition system and the other states in the array, we can perform the chain of transitions,
sequentially to all the states in the array, and all the transitions will be valid.</p><p>Example:</p><pre lang="C#"><span class="keyword highlighter">var</span> solution = TransitionSystem.Labyrinth(<span class="_custom-word_ highlighter">VisitorState</span>.Entry, <span class="_custom-word_ highlighter">VisitorState</span>.Exit);
<span class="keyword highlighter">if</span> (solution.Length &gt; <span class="literal numeric highlighter">0</span>)
    <span class="keyword highlighter">foreach</span> (<span class="keyword highlighter">var</span> state <span class="keyword highlighter">in</span> solution[<span class="literal numeric highlighter">0</span>]) <span class="comment text highlighter">// or any other solution path</span>
        TransitionSystem.TryTransitionTo(state); <span class="comment text highlighter">// always valid</span>
</pre><h2 id="heading-delegate-acceptortransitionaction">Delegate AcceptorTransitionAction</h2>
<p>The delegate <code>AcceptorTransitionAction</code> is used to define an acceptor’s <em>state-transition function</em> using <a href="#heading-addstatetransitionfunctionpart%22"><code>AddStateTransitionFunctionPart</code></a>.</p><pre lang="C#"><span class="keyword highlighter">public</span> <span class="keyword highlighter">delegate</span> <span class="_custom-word_ highlighter">STATE</span> AcceptorTransitionAction&lt;<span class="_custom-word_ highlighter">STATE</span>, <span class="_custom-word_ highlighter">INPUT</span>&gt; (<span class="_custom-word_ highlighter">STATE</span> state, <span class="_custom-word_ highlighter">INPUT</span> input);
</pre><h2 id="heading-delegate-invalidacceptorinputhandler">Delegate InvalidAcceptorInputHandler</h2>
<p>The delegate <code>InvalidAcceptorInputHandler</code> is used to provide additional information on invalid input using the method
<a href="#heading-addinvalidinput"><code>AddInvalidInput</code></a>.</p><pre lang="C#"><span class="keyword highlighter">public</span> <span class="keyword highlighter">delegate</span> <span class="type keyword highlighter">string</span> InvalidAcceptorInputHandler&lt;<span class="_custom-word_ highlighter">STATE</span>, <span class="_custom-word_ highlighter">INPUT</span>&gt; (<span class="_custom-word_ highlighter">STATE</span> state, <span class="_custom-word_ highlighter">INPUT</span> input);
</pre><h2 id="heading-class-acceptor">Class Acceptor</h2>
<p>The class <code>Acceptor</code> implements the functionality of a <a href="https://en.wikipedia.org/wiki/Finite-state_machine#Mathematical_model">finite-state acceptor</a>.</p><pre lang="C#"><span class="keyword highlighter">public</span> <span class="keyword highlighter">class</span> <span class="_custom-word_ highlighter">Acceptor</span>&lt;<span class="_custom-word_ highlighter">STATE</span>, <span class="_custom-word_ highlighter">INPUT</span>&gt; : TransitionSystem&lt;<span class="_custom-word_ highlighter">STATE</span>&gt; {<span class="comment block highlighter">/* &hellip; */</span>}
</pre><h3 id="heading-inherited-public-members">Inherited Public Members</h3>
<p><a href="#heading-resetstate">TransitionSystem.ResetState</a>,
<a href="#heading-addvalidstatetransition">TransitionSystem.AddValidStateTransition</a>,
<a href="#heading-addvalidstatetransitionchain">TransitionSystem.AddValidStateTransitionChain</a>,
<a href="#heading-addinvalidstatetransition">TransitionSystem.AddInvalidStateTransition</a>,
<a href="#heading-istransitionvalid">TransitionSystem.IsTransitionValid</a>,
<a href="#heading-trytransitionto">TransitionSystem.TryTransitionToTransitionSystem.</a>,
<a href="#heading-labyrinth">TransitionSystem.LabyrinthTransitionSystem.</a>,
<a href="#heading-finddeadends">TransitionSystem.FindDeadEnds</a>,
<a href="#heading-currentstate">TransitionSystem.CurrentState</a>,
<a href="#heading-longestpaths">TransitionSystem.LongestPaths</a>,
<a href="#heading-maximumpaths">TransitionSystem.MaximumPaths</a>,</p><h3 id="heading-public-constructor.">Public Constructor</h3>
<pre lang="C#"><span class="keyword highlighter">public</span> <span class="_custom-word_ highlighter">Acceptor</span>(<span class="_custom-word_ highlighter">STATE</span> initialState = <span class="keyword highlighter">default</span>) : <span class="keyword highlighter">base</span>(initialState = <span class="keyword highlighter">default</span>);
</pre><h3 id="heading-public-methods.">Public Methods</h3>
<h4 id="heading-addstatetransitionfunctionpart">AddStateTransitionFunctionPart</h4>
<pre lang="C#"><span class="keyword highlighter">public</span> <span class="keyword highlighter">void</span> AddStateTransitionFunctionPart(
    <span class="_custom-word_ highlighter">INPUT</span> input, <span class="_custom-word_ highlighter">STATE</span> state,
    <span class="_custom-word_ highlighter">AcceptorTransitionAction</span>&lt;<span class="_custom-word_ highlighter">STATE</span>, <span class="_custom-word_ highlighter">INPUT</span>&gt; handler);
</pre><h4 id="heading-addinvalidinput">AddInvalidInput</h4>
<p>The method <code>AddInvalidInput</code> is used to provide additional information on the <code>state</code> and <code>input</code> pair. It is used by <a href="#heading-transitionsignal"><code>TransitionSignal</code></a>: when these methods find that a <em>state-transition function</em> is not implemented for a <a href="#heading-currentstate"><code>CurrentState</code></a> and <code>input</code> pair, it looks for the invalid acceptor input information to provide an explanation of why the function is not implemented for this pair. If this additional information is not found, <a href="#heading-transitionsignal"><code>TransitionSignal</code></a> returns a general issue description.</p><pre lang="C#"><span class="keyword highlighter">public</span> <span class="keyword highlighter">void</span> AddInvalidInput(<span class="_custom-word_ highlighter">INPUT</span> input, <span class="_custom-word_ highlighter">STATE</span> state, InvalidAcceptorInputHandler&lt;<span class="_custom-word_ highlighter">STATE</span>, <span class="_custom-word_ highlighter">INPUT</span>&gt; handler);
</pre><h4 id="heading-transitionsignal">TransitionSignal</h4>
<p>The method <code>TransitionSignal</code> looks at the <em>state-transition function</em> using the combination of <code>input</code> and <a href="#heading-currentstate"><code>CurrentState</code></a>. If possible, it performs the transition to the state according to the state-transition function, otherwise, it reports the issues.</p><pre lang="C#"><span class="keyword highlighter">public</span> record TransitionSignalResult(<span class="_custom-word_ highlighter">STATE</span> State, <span class="type keyword highlighter">bool</span> Success, <span class="type keyword highlighter">string</span> Comment);

<span class="keyword highlighter">public</span> TransitionSignalResult TransitionSignal(<span class="_custom-word_ highlighter">INPUT</span> input)andler&lt;<span class="_custom-word_ highlighter">STATE</span>, <span class="_custom-word_ highlighter">INPUT</span>&gt; handler);
</pre><h2 id="heading-delegate-mooremachineoutputaction">Delegate MooreMachineOutputAction</h2>
<p>The delegate <code>MooreMachineOutputAction</code> is used to define an output function for a <a href="#heading-class-transducer">transducer</a> using the <a href="https://en.wikipedia.org/wiki/Moore_machine">Moore model</a>,
see <a href="#heading-addoutputfunctionpart">AddOutputFunctionPart</a>.</p><pre lang="C#"><span class="keyword highlighter">public</span> <span class="keyword highlighter">delegate</span> <span class="_custom-word_ highlighter">OUTPUT</span> MooreMachineOutputAction&lt;<span class="_custom-word_ highlighter">STATE</span>, <span class="_custom-word_ highlighter">INPUT</span>, <span class="_custom-word_ highlighter">OUTPUT</span>&gt; (<span class="_custom-word_ highlighter">STATE</span> state);
</pre><h2 id="heading-delegate-mealymachineoutputaction">Delegate MealyMachineOutputAction</h2>
<p>The delegate <code>MealyMachineOutputAction</code> is used to define an output function for a <a href="#heading-class-transducer">transducer</a> using the <a href="https://en.wikipedia.org/wiki/Mealy_machine">Mealy model</a>,
see <a href="#heading-addoutputfunctionpart">AddOutputFunctionPart</a>.</p><pre lang="C#"><span class="keyword highlighter">public</span> <span class="keyword highlighter">delegate</span> <span class="_custom-word_ highlighter">OUTPUT</span> MealyMachineOutputAction&lt;<span class="_custom-word_ highlighter">STATE</span>, <span class="_custom-word_ highlighter">INPUT</span>, <span class="_custom-word_ highlighter">OUTPUT</span>&gt; (<span class="_custom-word_ highlighter">STATE</span> state, <span class="_custom-word_ highlighter">INPUT</span> input);
</pre><h2 id="heading-class-transducer">Class Transducer</h2>
<p>The class <code>Transducer</code> implements the functionality of a <a href="https://en.wikipedia.org/wiki/Finite-state_machine#Mathematical_model">finite-state transducer</a>.</p><pre lang="C#"><span class="keyword highlighter">public</span> <span class="keyword highlighter">class</span> <span class="_custom-word_ highlighter">Transducer</span>&lt;<span class="_custom-word_ highlighter">STATE</span>, <span class="_custom-word_ highlighter">INPUT</span>, <span class="_custom-word_ highlighter">OUTPUT</span>&gt; : <span class="_custom-word_ highlighter">Acceptor</span>&lt;<span class="_custom-word_ highlighter">STATE</span>, <span class="_custom-word_ highlighter">INPUT</span>&gt; {<span class="comment block highlighter">/* &hellip; */</span>}
</pre><h3 id="heading-inherited-public-members.">Inherited Public Members</h3>
<p><a href="#heading-resetstate">TransitionSystem.ResetState</a>,
<a href="#heading-addvalidstatetransition">TransitionSystem.AddValidStateTransition</a>,
<a href="#heading-addvalidstatetransitionchain">TransitionSystem.AddValidStateTransitionChain</a>,
<a href="#heading-addinvalidstatetransition">TransitionSystem.AddInvalidStateTransition</a>,
<a href="#heading-istransitionvalid">TransitionSystem.IsTransitionValid</a>,
<a href="#heading-trytransitionto">TransitionSystem.TryTransitionToTransitionSystem.</a>,
<a href="#heading-labyrinth">TransitionSystem.LabyrinthTransitionSystem.</a>,
<a href="#heading-finddeadends">TransitionSystem.FindDeadEnds</a>,
<a href="#heading-currentstate">TransitionSystem.CurrentState</a>,
<a href="#heading-longestpaths">TransitionSystem.LongestPaths</a>,
<a href="#heading-maximumpaths">TransitionSystem.MaximumPaths</a>,</p><p><a href="#heading-addstatetransitionfunctionpart">Accessor.AddStateTransitionFunctionPart</a>,
<a href="#heading-addinvalidinput">Accessor.AddInvalidInput</a>,
<a href="#heading-transitionsignal">Accessor.TransitionSignal</a></p><h3 id="heading-public-constructor..">Public Constructor</h3>
<pre lang="C#"><span class="keyword highlighter">public</span> <span class="_custom-word_ highlighter">Transducer</span>(<span class="_custom-word_ highlighter">STATE</span> initialState = <span class="keyword highlighter">default</span>) : <span class="keyword highlighter">base</span>(initialState);
</pre><h3 id="heading-public-methods..">Public Methods</h3>
<h4 id="heading-addoutputfunctionpart">AddOutputFunctionPart</h4>
<p>There are two functions under the same name <code>AddOutputFunctionPart</code>: one is used to develop a <a href="https://en.wikipedia.org/wiki/Moore_machine">Moore finite-state machine</a>, and another one — to develop a <a href="https://en.wikipedia.org/wiki/Mealy_machine">Mealy finite-state machine</a>.</p><p>Moore version:</p><pre lang="C#"><span class="keyword highlighter">public</span> <span class="keyword highlighter">void</span> AddOutputFunctionPart(
    <span class="_custom-word_ highlighter">INPUT</span> input, <span class="_custom-word_ highlighter">STATE</span> state,
    <span class="_custom-word_ highlighter">MooreMachineOutputAction</span>&lt;<span class="_custom-word_ highlighter">STATE</span>, <span class="_custom-word_ highlighter">INPUT</span>, <span class="_custom-word_ highlighter">OUTPUT</span>&gt; handler);
</pre><p>Mealy version:</p><pre lang="C#"><span class="keyword highlighter">public</span> <span class="keyword highlighter">void</span> AddOutputFunctionPart(
    <span class="_custom-word_ highlighter">INPUT</span> input, <span class="_custom-word_ highlighter">STATE</span> state,
    <span class="_custom-word_ highlighter">MealyMachineOutputAction</span>&lt;<span class="_custom-word_ highlighter">STATE</span>, <span class="_custom-word_ highlighter">INPUT</span>, <span class="_custom-word_ highlighter">OUTPUT</span>&gt; handler);
</pre><p>If an output function of a state machine uses a mixture of Moore and Mealy functions for different function arguments, it is, formally speaking, a Mealy machine.</p><p>See also: <a href="#heading-delegate-mooremachineoutputaction">MooreMachineOutputAction</a>, <a href="#heading-delegate-mealymachineoutputaction">MealyMachineOutputAction</a>.</p><h4 id="heading-signal">Signal</h4>
<p>The method <code>Signal</code> looks for both <em>state-transition function</em> and <em>output function</em> using the combination of <code>input</code> and <a href="#heading-currentstate"><code>Acceptor.CurrentState</code></a>. If possible, it performs the transition to the state according to the state-transition function and calculates the <code>Output</code>, otherwise, it reports the issues.</p><p>In other words, it calls <a href="#heading-transitionsignal"><code>Acceptor.TransitionSignal</code></a>, takes its output, then uses the <em>output function</em>, and combines the results.</p><pre lang="C#"><span class="keyword highlighter">public</span> record SignalResult(
    TransitionSignalResult TransitionResult,
    <span class="_custom-word_ highlighter">OUTPUT</span> Output, <span class="type keyword highlighter">bool</span> OutputSuccess = <span class="literal keyword highlighter">true</span>, <span class="type keyword highlighter">string</span> OutputComment = <span class="literal keyword highlighter">null</span>);

<span class="keyword highlighter">public</span> SignalResult Signal(<span class="_custom-word_ highlighter">INPUT</span> input);
</pre><h1 id="heading-examples">Examples</h1>
<h2 id="heading-room-door-example">Room Door Example</h2>
<p>Basic transition system example with 6 states forming a linear transition graph. Demonstrates valid transitions and attempts to perform an invalid transition.</p><p><a href="https://github.com/SAKryukov/generic-state-machine/tree/main/code/Tests/TestDoor">Source code</a>
<br/><a href="Example.Door.html">Description</a></p><h2 id="heading-non-enumeration-example">Non-Enumeration Example</h2>
<p>This example shows the use of a non-enumerable type as a <code>TransitionSystem</code> generic parameter. The type <code>double</code> is used as a source of the state set.</p><p><a href="https://github.com/SAKryukov/generic-state-machine/tree/main/code/Tests/Test.Non-Emumeration">Source code</a>
<br/><a href="Example.Non-Emumeration.html">Description</a></p><h2 id="heading-grid-example">Grid Example</h2>
<p>This example demonstrates that NP-hard problems can be pretty hard even for the 24 states. The states in this
example form a 6x4 grid with the permitted <em>undirected</em> transition between all neighboring cells.
The example demonstrates the calculation of the longest path between two states and the maximum number of possible paths.</p><p>Maximum number of paths between a pair of states is 5493.<br/>
Total number of paths: 1603536, longest path length: 23.</p><p><a href="https://github.com/SAKryukov/generic-state-machine/tree/main/code/Tests/TestGrid">Source code</a>
<br/><a href="Example.Grid.html">Description</a></p><h2 id="heading-zoo-example">Zoo Example</h2>
<p>The Zoo example demonstrates the transition system representing the visitor location at the zoo. This example demonstrates all the <code>TransitionSystem</code> features.</p><p><a href="https://github.com/SAKryukov/generic-state-machine/tree/main/code/Tests/TestZoo">Source code</a>
<br/><a href="Example.Zoo.html">Description</a></p><h2 id="heading-car-transducer-example">Car Transducer Example</h2>
<p>The Car Transducer Example is a comprehensive example demonstrating <a href="#heading-class-acceptor">Acceptor</a>
and <a href="#heading-class-transducer">Transducer</a> features on a highly simplified model of a car with automatic transmission,
keyless entry, only three gearbox positions, and lights.</p><p><a href="https://github.com/SAKryukov/generic-state-machine/tree/main/code/Tests/Test.Transducer.Car">Source code</a>
<br/><a href="Example.Transducer.Car.html">Description</a></p><h1 id="heading-compatibility-and-build">Compatibility and Build</h1>
<p>The solution is compatible with any <a href="https://en.wikipedia.org/wiki/.NET">.NET</a> version. For the earliest common denominator, I use v. 5; by the moment of writing, I tested the versions from 5 to 9.</p><p>To change the target .NET version, edit the file <a href="https://github.com/SAKryukov/generic-state-machine/blob/main/code/Directory.Build.props">“Directory.Build.props”</a>, the property <code>&lt;TargetFramework&gt;</code>.
Also, the code can be used for some <a href="https://en.wikipedia.org/wiki/.NET_Framework">.NET Framework</a> versions. However, it will require re-creation of project files, which is not hard to do.</p><p>The build does not require Visual Studio, Visual Studio Code, or any other IDE. It can be done using the commands</p><pre>dotnet build -c Debug
dotnet build -c Release
</pre><p>With Visual Studio or Visual Studio Code, the code can be built in the usual ways. Besides, for Visual Studio Code, a <a href="https://github.com/SAKryukov/generic-state-machine/blob/main/code/.vscode/launch.json">launch configuration “Build All”</a> and a <a href="https://github.com/SAKryukov/generic-state-machine/blob/main/code/.vscode/tasks.json">task “Build All”</a> are provided.</p><p class="extensible-markdown">This documentation is generated from the extended Markdown documentation using <a href="https://marketplace.visualstudio.com/items?itemName=sakryukov.extensible-markdown">Extensible Markdown</a>
for Visual Studio Code.</p><div  data-line="454" class="code-line" dir="auto" ></div>
<script src="https://SAKryukov.github.io/publications/code/source-code-decorator.js"></script>


</body>
</html>
